<script>
    const areaData = {
        '1층-1구역': [
            '로비/접견실', '화장실/소회의실', '교육장', '중회의실2', '중회의실3',
            '대회의실', '보건실', 'TC룸/TC룸 스막', 'GSS 측 화장실'
        ],
        '1층-2구역': [
            '자재창고', 'GPU 스막', 'GPU', 'GPU 최종검사', 'GPU 용접실',
            'GPU 준비실', '품질분석실'
        ],
        '1층-3구역': [
            { text: '주안 GSS 스막' },
            { text: '주안 GSS' },
            { text: '1층 협력사 벤더1' },
            { text: '1층 협력사 벤더2' },
            { text: '1층 협력사 벤더3' },
            { text: '1층 협력사 벤더4' },
            { text: '1층 협력사 벤더5' },
            { text: '2층 협력사 벤더6' },
            { text: '2층 협력사 벤더7' },
            { text: '2층 협력사 벤더8' },
            { text: '2층 협력사 벤더9' },
            { text: '2층 협력사 벤더10' }
        ],
        '1층-4구역': [
            'GSS 스막', 'GSS', 'GSS PA', 'IGS', 'GSS 최종검사',
            '소모품창고', '반출입구'
        ],
        '2층 구역': [
            '피트니스', '탈의실', '화장실, 세탁실', '직원휴게실'
        ],
        '3층-1구역': [
            '경영지원실/ 부사장실', '대회의실', '행복A 회의실', '행복B 회의실', '화장실', '탕비실',
            '중회의실', '자유A 회의실', '자유B 회의실', '자유C 회의실', '자유D 회의실', '직속,영업 WS/ 대표이사실'
        ],
        '3층-2구역': [
            '연구소 WS', '생산기술WS', '고객지원창고', '소통A 회의실', '소통B 회의실',
            '제조,CS WS', '전산실, 서버실', '제품TEST실/ 제어 TEST실', '공조실',
            '자재창고'
        ],
        '4층 구역': [
            '카페', '식당 및 주방', '주방 휴게실', '다목적실',
            '직원휴게실', '방재실', '문서고'
        ],
        '지하층 구역': [
            '지하 크린룸', '창고', '미화 협력사 휴게실', '일반창고',
            '컨트롤룸', '기계실', '전기실', '발전기실'
        ],
        '지원조 임무': '<strong>현장 안전통제 및 집결지 안내:</strong> GATE1, GATE2 앞 옥외 등 인원 밀집 예상 지역에서 안전을 확보하고 피난 유도.<br><br><strong>예비 인력 운영:</strong> 각 구역에 인원이 부재할 경우 즉시 투입하여 임무를 대행.'
    };

    function openTab(evt, tabName) {
        const tabcontent = document.getElementsByClassName("tab-content");
        for (let i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        const tablinks = document.getElementsByClassName("tab-btn");
        for (let i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }

    function openPopup(area) {
        const popup = document.getElementById('info-popup');
        const popupTitle = popup.querySelector('.popup-title');
        const popupDetailList = document.getElementById('popup-detail-list');

        popupTitle.textContent = area;
        popupDetailList.innerHTML = '';

        // 피난안내도 이미지 추가
        const escapeMapImg = document.createElement('img');
        escapeMapImg.src = 'https://github.com/hyunjiklee119-collab/FRT119/raw/8aec6e959c01f7ecf367af0a30f91c99d2716568/562119_179569_1341.jpg';
        escapeMapImg.alt = '피난안내도';
        escapeMapImg.style.maxWidth = '100%';
        escapeMapImg.style.height = 'auto';
        escapeMapImg.style.marginBottom = '15px';
        escapeMapImg.style.borderRadius = '5px';
        popupDetailList.appendChild(escapeMapImg);

        const data = areaData[area];
        if (typeof data === 'string') {
            popupDetailList.innerHTML += `<p>${data}</p>`;
        } else if (Array.isArray(data)) {
            const ul = document.createElement('ul');
            const listWrapper = document.createElement('div');
            listWrapper.classList.add('popup-list');

            if (data.length > 5) {
                listWrapper.classList.add('two-columns');
            } else {
                listWrapper.classList.remove('two-columns');
            }

            data.forEach((item, index) => {
                const li = document.createElement('li');
                const checkboxId = `${area}-${index}`;
                const isChecked = localStorage.getItem(checkboxId) === 'true';
                const itemText = typeof item === 'object' ? item.text : item;

                li.innerHTML = `
                    <input type="checkbox" id="${checkboxId}" ${isChecked ? 'checked' : ''}>
                    <label for="${checkboxId}">${itemText}</label>
                `;
                if (isChecked) {
                    li.classList.add('checked');
                }

                li.querySelector('input').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        li.classList.add('checked');
                        localStorage.setItem(checkboxId, 'true');
                    } else {
                        li.classList.remove('checked');
                        localStorage.setItem(checkboxId, 'false');
                    }
                });

                ul.appendChild(li);
            });
            listWrapper.appendChild(ul);
            popupDetailList.appendChild(listWrapper);
        }

        popup.style.display = 'flex';
    }

    function closePopup() {
        document.getElementById('info-popup').style.display = 'none';
    }
    
    window.addEventListener('click', function(event) {
        const popup = document.getElementById('info-popup');
        if (event.target === popup) {
            closePopup();
        }
    });

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('floor1').style.display = 'block';
    });
</script>
